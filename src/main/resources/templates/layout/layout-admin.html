<!DOCTYPE html>
<html lang="en">
<!--Hay phải chạy Maven Compile để layout.html mới có hiệu lực-->

<head>
    <!-- <title>Layout-Admin UI</title> -->
    <title th:text="${title}">
        Layout-Admin UI
    </title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--Cài đặt thư viện giao diện (uix) jQuery Semantic -->
    <!--Cài đặt thư viện jQuery 3, Semantic UI 3 (có đủ Toast, Icon, Modal, Animation, ...)-->
    <!-- <script src="https://fomantic-ui.com/javascript/library/jquery.min.js" type="text/javascript"></script> -->
    <!--Cài đặt các thư viện jQuery Plugins vào chỗ giữa này để semantic không bị ảnh hưởng-->
    <!-- <script src="https://fomantic-ui.com/dist/semantic.min.js" type="text/javascript"></script> -->
    <!-- <link href="https://fomantic-ui.com/dist/semantic.min.css" type="text/css" rel="stylesheet" /> -->

    <!--Cài đặt thư viện giao diện (uix) jQuery SemanticUI 2.5 (không có Toast)-->
        <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
        <!--Cài đặt các thư viện jQuery Plugins vào chỗ giữa này để semantic không bị ảnh hưởng-->
        <script src="https://semantic-ui.com/dist/semantic.min.js"></script>
        <link  href="https://semantic-ui.com/dist/semantic.min.css" rel="stylesheet" />

    <!--
            Semantic UI > Table > Ajax
            https://education.iupui.edu/tep_admin/Editor-PHP-1.9.4/examples/styling/semanticui.html
        -->

    <!--Cài đặt trình soạn thảo văn bản jQuery Rich Text Editor : xem thử ở them.html của quangcao -->
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://www.jqueryscript.net/demo/Rich-Text-Editor-jQuery-RichText/richtext.min.css">
    <script src="https://www.jqueryscript.net/demo/Rich-Text-Editor-jQuery-RichText/jquery.richtext.js"></script>

    <!-- Cài đặt thư viện jQuery Summernote độc lập, không phụ thuộc Bootstrap -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/summernote/0.8.12/summernote-lite.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/summernote/0.8.12/summernote-lite.js"></script>

    <!--Cài đặt thư viện jQuery TinyMCE (Rich Text Editor)
    cái này tham khảo thêm thôi: xem quangcao/them.html -->
    <!-- <link href="/tinymce/skin.min.css" rel="stylesheet"> -->
    <!-- <link  href="/tinymce.min.js" rel="stylesheet"> NOT Works as CDN -->
    <!-- <script src="https://yellowred.info/stagb/plugins/tinymce/tinymce.min.js"></script> -->

    <!--
        Semantic UI > Table > Ajax
        https://education.iupui.edu/tep_admin/Editor-PHP-1.9.4/examples/styling/semanticui.html
    -->

    <!--Cài đặt jQuery Plugin: Menu Context: https://swisnl.github.io/jQuery-contextMenu -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/jquery-contextmenu/2.7.1/jquery.contextMenu.min.css"
        rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-contextmenu/2.7.1/jquery.contextMenu.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-contextmenu/2.7.1/jquery.ui.position.js"></script>

    <!--jQuery UI-->
    <link  href="https://code.jquery.com/ui/1.13.3/themes/base/jquery-ui.css" rel="stylesheet" >
    <script src="https://code.jquery.com/ui/1.13.3/jquery-ui.js" type="text/javascript"></script>
</head>

<body>

    <div class="ui bottom attached segment pushable">
        <div class="ui inverted left vertical sidebar menu">
            <a class="item" href="/admin/dashboard">
                <i class="home icon"></i> Admin (Logo)
            </a>

            <a class="item" href="/admin/ads">
                <i class="icon adversal"></i> Quảng Cáo
            </a>

            <a class="item" href="/admin/feedback">
                <i class="icon chat"></i> Phản Hồi
            </a>
            <a class="item" href="/admin/customer">
                <i class="icon smile"></i> Khách Hàng
            </a>
            <a class="item" href="/admin/order">
                <i class="icon tag"></i> Đơn Hàng
            </a>

            <a class="item" href="/admin/user">
                <i class="icon user"></i> Nhân Viên
            </a>
            <a class="item" href="/admin/settings">
                <i class="icon wrench"></i> Cài Đặt
            </a>
            <a class="item" href="/admin/image">
                <i class="icon smile"></i> Ảnh Hệ Thống
            </a>

            <a class="item" href="/admin/category">
                <i class="icon block layout"></i> Danh Mục, Loại
            </a>
            <a class="item" href="/admin/product">
                <i class="icon product hunt"></i> Sản Phẩm
            </a>
            <a class="item" href="/admin/product-image">
                <i class="icon product hunt"></i> Ảnh Sản Phẩm
            </a>
            <a class="item" href="/admin/manufacturer">
                <i class="icon amazon"></i> Nhà Sản Xuất
            </a>

        </div>
        <div class="pusher">

            <div class="ui stackable menu">
                <a class="item header toggle button">
                    ☰
                </a>

                <div class="menu right">
                    <a class="item header" th:text="'Xin chào '+${session.User_Fullname}">
                        Xin chào NV Quan Tri
                    </a>
                    <a class="item header" href="/admin/user/logout">
                        <i class="icon sign-out"></i>Log Out2
                    </a>
                </div>



            </div>

            <!--nội dung riêng-->
            <div th:replace="~{${content}}"></div> <!--Ok, không còn bị lỗi deprecated như khi chưa có ~{ ... }-->


        </div>
    </div>

    <script>
        $(function () {
            // Điều khiển hiệu ứng ẩn,hiện của SUI SideBar Menu (thanh menu dọc bên tay trái)
            $('.ui.dropdown').dropdown();
            $('.ui.sidebar').sidebar('attach events', '.toggle.button');

            // Đóng các hộp thoại thông báo một cách từ từ
            $('.message .close')
                .on('click', function () {
                    $(this)
                        .closest('.message')
                        .transition('fade')
                        ;
                })
                ;

            $('textarea').richText();
            // $('htmlEditor').richText();
        });
    </script>

    <script>
        // Kịch Bản JavaScript cho Image Upload sử dụng ở các Form
        // (JavaScript thuần)
        // Không nên dùng cú pháp: dom.onerror = function() vì nhỡ dom bị null
        // tương tụ: dom.oninput
        // Sử dụng cú pháp ?. của Null Conditional Operator để đỡ phải kiểm tra 
        // if(dom)
        // if(dom==undefined || dom==null)
        document.addEventListener("DOMContentLoaded", function() {
            // alert('test....');
            // console.log('hello');
            // Trường hợp đường dẫn ảnh bị lỗi thì thay thế bằng ảnh khác !
            var thumbnailImage = document.querySelector('img[name="thumbnail"]');
            thumbnailImage?.addEventListener("error", function() {
                this.src = 'https://cdn-icons-png.flaticon.com/512/149/149071.png'; // emtpty personal profile
                this.src = 'https://upload.wikimedia.org/wikipedia/commons/thumb/a/ac/No_image_available.svg/450px-No_image_available.svg.png'; // Placeholder image for "No Image"
            });

            // Tạo bóng râm cho ảnh (nên làm bằng css)
            // thumbnailImage?.style.boxShadow = '0 4px 8px rgba(0, 0, 0, 0.2)';
            // thumbnailImage?.style.borderRadius = '8px';

            // Thay đổi ảnh khi người dùng nhập URL mới
            var inputImageSource = document.getElementById('inputImageSource');
            inputImageSource?.addEventListener("input", function() {
                var newSrc = this.value;
                thumbnailImage.src = newSrc;
            });
        });

       /**
        * Thư viện phụ thuộc: Semantic.css
        */
        function uploadImage() {
            // Đã test kỹ, chạy rất OK
            // Truy cập vào các phần tử trên giao diện HTML
            // const uploadButton = document.getElementById("inputImage");
            const fileInput = document.createElement("input");
            fileInput.type = "file";
            fileInput.accept = "image/*";

            // Đăng ký kịch bản xử lý sự kiện cho fileInput
            // fileInput.on("change", (e) => { // chạy OK
            fileInput.onchange = function (event) { // chạy OK
                const uploading_text = document.getElementById("uploading_text");
                uploading_text.innerHTML = `Uploading...<i class="icon spinner loading"></i>`;

                const file = event.target.files[0];
                const formData = new FormData();
                formData.append("file", file);
                formData.append("upload_preset", "doc_codepen_example");

                const url = `https://api.cloudinary.com/v1_1/demo/image/upload`;
                const options = // settings, config 
                {
                    method: "POST",
                    body: formData,
                };

                window.
                    fetch(url, options)
                    .then((res) => res.json())
                    .then((data) => {
                        console.log(data.secure_url);

                        uploading_text.innerHTML = `<span class="ui green">Image upload completed ! <i class="icon check circle outline green"></i></span>`;


                        // Cập nhật giá trị của trường input ẩn với URL của ảnh đã tải lên
                        // document.querySelector('input[name="anh"]').value = data.secure_url;
                        document
                            .querySelector('#inputImageSource').value = data.secure_url;

                        // $('#imgView').prev('img') // cũ
                        // $('#imgThumbnail').attr('src', data.secure_url);

                        document
                            .querySelector('#imgThumbnail').src = data.secure_url;
                    })
                    .catch((err) => {
                        console.error(err);
                        uploading_text.innerText = "Upload failed.";
                    })
            };

            fileInput.click();
        }
    </script>

    <footer class="ui container">
        <!-- <div class="ui divider"></div> -->
        &copy; <span th:text="${#dates.format(#dates.createNow(),'YYYY')}"></span>. Powered by Java Spring Boot
        &nbsp;
        <!-- <span th:text="${caidat.get('email')}"></span> &nbsp;
    <span th:text="${caidat.get('phone')}"></span> &nbsp;
    <span th:text="${caidat.get('dia_chi')}"></span> &nbsp; -->
    </footer>


</body>

</html>